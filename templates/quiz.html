{% extends "base.html" %}
{% block title %}Take Quiz{% endblock %}

{% block content %}
<h2>Take Quiz</h2>

<div id="timer" class="mb-3 fs-5 text-danger"></div>

<form method="POST" id="quizForm">
  {% for question in questions %}
  <fieldset class="mb-4">
    <legend>{{ loop.index }}. {{ question['question'] }}</legend>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="{{ question['id'] }}" id="q{{ question['id'] }}o1" value="{{ question['option1'] }}" required>
      <label class="form-check-label" for="q{{ question['id'] }}o1">{{ question['option1'] }}</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="{{ question['id'] }}" id="q{{ question['id'] }}o2" value="{{ question['option2'] }}">
      <label class="form-check-label" for="q{{ question['id'] }}o2">{{ question['option2'] }}</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="{{ question['id'] }}" id="q{{ question['id'] }}o3" value="{{ question['option3'] }}">
      <label class="form-check-label" for="q{{ question['id'] }}o3">{{ question['option3'] }}</label>
    </div>
    <div class="form-check">
      <input class="form-check-input" type="radio" name="{{ question['id'] }}" id="q{{ question['id'] }}o4" value="{{ question['option4'] }}">
      <label class="form-check-label" for="q{{ question['id'] }}o4">{{ question['option4'] }}</label>
    </div>
  </fieldset>
  <hr>
  {% endfor %}

  <button type="submit" class="btn btn-primary">Submit Quiz</button>
</form>

<script>
  // Optional: Countdown timer in seconds
  let timeLeft = {{ duration * 60 }}; // duration in minutes passed from backend
  const timerElement = document.getElementById('timer');

  function updateTimer() {
    if (timeLeft <= 0) {
      alert("Time's up! The quiz will be submitted automatically.");
      document.getElementById('quizForm').submit();
      return;
    }
    let minutes = Math.floor(timeLeft / 60);
    let seconds = timeLeft % 60;
    timerElement.textContent = `Time Remaining: ${minutes}:${seconds.toString().padStart(2, '0')}`;
    timeLeft--;
  }

  setInterval(updateTimer, 1000);
  updateTimer(); // initial call to show timer immediately
</script>
{% endblock %}
